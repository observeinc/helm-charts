observe:
  # If create = false it is assumed that a secret named agent-credentials with key: OBSERVE_TOKEN already exists
  token:
    create: true
    value: ""
  # ex -  https://12345678.collect.observeinc.com
  collectionEndpoint:
    value: ""
  # this is temporary and will be removed
  entityToken:
    # To create secret
    create: false
    value: ""
    # To use exporter
    use: false


cluster:
  name: observe-agent-monitored-cluster
  events:
    pullInterval: 20m
    enabled: true
  metrics:
    enabled: true

  namespaceOverride:
    # ! This needs to have same value as namespaceOverride in deployments and daemonsets below
    value: observe
  uidOverride:
    value: ""

containers:
  logs:
    enabled: true
  metrics:
    enabled: true

agent:
  config:
    global:
      processors:
        batch:
          send_batch_size: 100
          send_batch_max_size: 100
      service:
        telemetry:
          metrics_level: normal
          logging_level: WARN
          logging_encoding: console 
      debug:
        # values basic, normal, detailed
        verbosity: basic
  selfMonitor:
    enabled: true


################################################
deployment-cluster-events:
  mode: deployment

  # ----------------------------------------- #
  # Different for each deployment/daemonset #
  nameOverride: "deployment-cluster-events"
  namespaceOverride: "observe"

  configMap:
    create: false
    existingName: "deployment-cluster-events"
  # ----------------------------------------- #

  # ----------------------------------------- #
  # Same for each deployment/daemonset      #
  resources:
    requests:
      cpu: 250m
      memory: 256Mi

  image:
    repository: observeinc/observe-agent
    # Overrides the image tag whose default is the chart appVersion.
    # The service's name will be applied to the end of this value.
    tag: "1.0.0"
    pullPolicy: IfNotPresent

  command:
    name: "observe-agent"
    extraArgs: ["start", "--config=/observe-agent-conf/observe-agent.yaml", "--otel-config=/conf/relay.yaml"]

  serviceAccount:
    create: false
    name: "observe-agent-service-account"

  clusterRole:
    create: false
    name: "observe-agent-cluster-role"

  livenessProbe:
    httpGet:
      port: 13133
      path: /status
    initialDelaySeconds: 30
    periodSeconds: 5
  readinessProbe:
    httpGet:
      port: 13133
      path: /status
    initialDelaySeconds: 30
    periodSeconds: 5

  networkPolicy:
    enabled: true
    egressRules: [{}]


  podAnnotations: {
    observe_monitor_purpose: observecollection,
    observe_monitor_scrape: 'true',
    observe_monitor_path: '/metrics',
    observe_monitor_port: '8888',
  }
  ports:
    metrics:
      # The metrics port is disabled by default. However you need to enable the port
      # in order to use the ServiceMonitor (serviceMonitor.enabled) or PodMonitor (podMonitor.enabled).
      enabled: true
      containerPort: 8888
      servicePort: 8888
      protocol: TCP
  # this init container provides the cluster uid (kube-system namespace) as config map
  initContainers:
    - name: kube-cluster-info
      image: observeinc/kube-cluster-info:v0.11.1
      imagePullPolicy: Always
      env:
        - name: NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
  # extract clusteruid from configmap create by init container
  extraEnvs:
    - name: OBSERVE_CLUSTER_NAME
      valueFrom:
        configMapKeyRef:
          name: cluster-name
          key: name
    - name: OBSERVE_CLUSTER_UID
      valueFrom:
        configMapKeyRef:
          name: cluster-info
          key: id
    - name: TOKEN
      valueFrom:
        secretKeyRef:
          name: agent-credentials
          key: OBSERVE_TOKEN
          optional: true
    - name: ENTITY_TOKEN
      valueFrom:
        secretKeyRef:
          name: agent-credentials
          key: ENTITY_TOKEN
          optional: true
  extraEnvsFrom: []
  extraVolumes:
    - name: "observe-agent-deployment-config"
      configMap:
        name: "observe-agent"
        items:
          - key: "relay"
            path: "observe-agent.yaml"
        defaultMode: 420

  extraVolumeMounts:
    - name: observe-agent-deployment-config
      mountPath: /observe-agent-conf
  # ----------------------------------------- #

################################################
deployment-cluster-metrics:
  mode: deployment
  # ----------------------------------------- #
  # Different for each deployment/daemonset #
  nameOverride: "deployment-cluster-metrics"
  namespaceOverride: "observe"

  configMap:
    create: false
    existingName: "deployment-cluster-metrics"
  # ----------------------------------------- #

  # ----------------------------------------- #
  # Same for each deployment/daemonset      #
  resources:
    requests:
      cpu: 250m
      memory: 256Mi

  image:
    repository: observeinc/observe-agent
    # # Overrides the image tag whose default is the chart appVersion.
    # # The service's name will be applied to the end of this value.
    tag: "1.0.0"
    pullPolicy: IfNotPresent

  command:
    name: "observe-agent"
    extraArgs: ["start", "--config=/observe-agent-conf/observe-agent.yaml", "--otel-config=/conf/relay.yaml"]

  serviceAccount:
    create: false
    name: "observe-agent-service-account"
  clusterRole:
    create: false
    name: "observe-agent-cluster-role"

  livenessProbe:
    httpGet:
      port: 13133
      path: /status
    initialDelaySeconds: 30
    periodSeconds: 5

  readinessProbe:
    httpGet:
      port: 13133
      path: /status
    initialDelaySeconds: 30
    periodSeconds: 5

  networkPolicy:
    enabled: true
    egressRules: [{}]

  podAnnotations: {
    observe_monitor_purpose: observecollection,
    observe_monitor_scrape: 'true',
    observe_monitor_path: '/metrics',
    observe_monitor_port: '8888',
  }
  ports:
    metrics:
      # The metrics port is disabled by default. However you need to enable the port
      # in order to use the ServiceMonitor (serviceMonitor.enabled) or PodMonitor (podMonitor.enabled).
      enabled: true
      containerPort: 8888
      servicePort: 8888
      protocol: TCP
  # this init container provides the cluster uid (kube-system namespace) as config map
  initContainers:
    - name: kube-cluster-info
      image: observeinc/kube-cluster-info:v0.11.1
      imagePullPolicy: Always
      env:
        - name: NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
  # extract clusteruid from configmap create by init container
  extraEnvs:
    - name: OBSERVE_CLUSTER_NAME
      valueFrom:
        configMapKeyRef:
          name: cluster-name
          key: name
    - name: OBSERVE_CLUSTER_UID
      valueFrom:
        configMapKeyRef:
          name: cluster-info
          key: id
    - name: TOKEN
      valueFrom:
        secretKeyRef:
          name: agent-credentials
          key: OBSERVE_TOKEN
          optional: true
  extraEnvsFrom: []
  extraVolumes:
    - name: "observe-agent-deployment-config"
      configMap:
        name: "observe-agent"
        items:
          - key: "relay"
            path: "observe-agent.yaml"
        defaultMode: 420
  extraVolumeMounts:
    - name: observe-agent-deployment-config
      mountPath: /observe-agent-conf
  # ----------------------------------------- #

################################################
daemonset-logs-metrics:
  mode: daemonset
  # ----------------------------------------- #
  # Different for each deployment/daemonset #
  nameOverride: "daemonset-logs-metrics"
  namespaceOverride: "observe"

  configMap:
    create: false
    existingName: "daemonset-logs-metrics"
  # ----------------------------------------- #

  # ----------------------------------------- #
  # Same for each deployment/daemonset      #
  resources:
    requests:
      cpu: 250m
      memory: 256Mi

  image:
    repository: observeinc/observe-agent
    # # Overrides the image tag whose default is the chart appVersion.
    # # The service's name will be applied to the end of this value.
    tag: "1.0.0"
    pullPolicy: IfNotPresent

  command:
    name: "observe-agent"
    extraArgs: ["start", "--config=/observe-agent-conf/observe-agent.yaml", "--otel-config=/conf/relay.yaml"]

  serviceAccount:
    create: false
    name: "observe-agent-service-account"
  clusterRole:
    create: false
    name: "observe-agent-cluster-role"

  livenessProbe:
    httpGet:
      port: 13133
      path: /status
    initialDelaySeconds: 30
    periodSeconds: 5

  readinessProbe:
    httpGet:
      port: 13133
      path: /status
    initialDelaySeconds: 30
    periodSeconds: 5

  networkPolicy:
    enabled: true
    egressRules: [{}]

  podAnnotations: {
    observe_monitor_purpose: observecollection,
    observe_monitor_scrape: 'true',
    observe_monitor_path: '/metrics',
    observe_monitor_port: '8888',
  }
  ports:
    metrics:
      # The metrics port is disabled by default. However you need to enable the port
      # in order to use the ServiceMonitor (serviceMonitor.enabled) or PodMonitor (podMonitor.enabled).
      enabled: true
      containerPort: 8888
      servicePort: 8888
      protocol: TCP
  # this init container provides the cluster uid (kube-system namespace) as config map
  initContainers:
    - name: kube-cluster-info
      image: observeinc/kube-cluster-info:v0.11.1
      imagePullPolicy: Always
      env:
        - name: NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
  # extract clusteruid from configmap create by init container
  extraEnvs:
    - name: OBSERVE_CLUSTER_NAME
      valueFrom:
        configMapKeyRef:
          name: cluster-name
          key: name
    - name: OBSERVE_CLUSTER_UID
      valueFrom:
        configMapKeyRef:
          name: cluster-info
          key: id
    - name: K8S_NODE_NAME
      valueFrom:
        fieldRef:
          fieldPath: spec.nodeName
    - name: TOKEN
      valueFrom:
        secretKeyRef:
          name: agent-credentials
          key: OBSERVE_TOKEN
          optional: true
  extraEnvsFrom: []
  extraVolumes:
    - name: "observe-agent-deployment-config"
      configMap:
        name: "observe-agent"
        items:
          - key: "relay"
            path: "observe-agent.yaml"
        defaultMode: 420
    - name: varlogpods
      hostPath:
        path: /var/log/pods
    - name: varlibdockercontainers
      hostPath:
        path: /var/lib/docker/containers
    - name: varlibotelcol
      hostPath:
        path: /var/lib/otelcol
        type: DirectoryOrCreate
    - name: hostfs
      hostPath:
        path: /
  extraVolumeMounts:
    - name: observe-agent-deployment-config
      mountPath: /observe-agent-conf
    - name: varlogpods
      mountPath: /var/log/pods
      readOnly: true
    - name: varlibdockercontainers
      mountPath: /var/lib/docker/containers
      readOnly: true
    - name: varlibotelcol
      mountPath: /var/lib/otelcol
    - name: hostfs
      mountPath: /hostfs
      readOnly: true
      mountPropagation: HostToContainer

  securityContext:
    runAsUser: 0
    runAsGroup: 0
  # ----------------------------------------- #

################################################
deployment-agent-monitor:
  mode: deployment
  # ----------------------------------------- #
  # Different for each deployment/daemonset #
  nameOverride: "deployment-agent-monitor"
  namespaceOverride: "observe"

  configMap:
    create: false
    existingName: "deployment-agent-monitor"
  # ----------------------------------------- #

  # ----------------------------------------- #
  # Same for each deployment/daemonset      #
  resources:
    requests:
      cpu: 250m
      memory: 256Mi

  image:
    repository: observeinc/observe-agent
    # # Overrides the image tag whose default is the chart appVersion.
    # # The service's name will be applied to the end of this value.
    tag: "1.0.0"
    pullPolicy: IfNotPresent

  command:
    name: "observe-agent"
    extraArgs: ["start", "--config=/observe-agent-conf/observe-agent.yaml", "--otel-config=/conf/relay.yaml"]

  serviceAccount:
    create: false
    name: "observe-agent-service-account"
  clusterRole:
    create: false
    name: "observe-agent-cluster-role"

  livenessProbe:
    httpGet:
      port: 13133
      path: /status
    initialDelaySeconds: 30
    periodSeconds: 5

  readinessProbe:
    httpGet:
      port: 13133
      path: /status
    initialDelaySeconds: 30
    periodSeconds: 5

  networkPolicy:
    enabled: true
    egressRules: [{}]

  podAnnotations: {
    observe_monitor_purpose: observecollection,
    observe_monitor_scrape: 'false',
    observe_monitor_path: '/metrics',
    observe_monitor_port: '8888',
  }
  ports:
    metrics:
      # The metrics port is disabled by default. However you need to enable the port
      # in order to use the ServiceMonitor (serviceMonitor.enabled) or PodMonitor (podMonitor.enabled).
      enabled: true
      containerPort: 8888
      servicePort: 8888
      protocol: TCP
  # this init container provides the cluster uid (kube-system namespace) as config map
  initContainers:
    - name: kube-cluster-info
      image: observeinc/kube-cluster-info:v0.11.1
      imagePullPolicy: Always
      env:
        - name: NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
  # extract clusteruid from configmap create by init container
  extraEnvs:
    - name: OBSERVE_CLUSTER_NAME
      valueFrom:
        configMapKeyRef:
          name: cluster-name
          key: name
    - name: OBSERVE_CLUSTER_UID
      valueFrom:
        configMapKeyRef:
          name: cluster-info
          key: id
    - name: TOKEN
      valueFrom:
        secretKeyRef:
          name: agent-credentials
          key: OBSERVE_TOKEN
          optional: true
  extraEnvsFrom: []
  extraVolumes:
    - name: "observe-agent-deployment-config"
      configMap:
        name: "observe-agent"
        items:
          - key: "relay"
            path: "observe-agent.yaml"
        defaultMode: 420
  extraVolumeMounts:
    - name: observe-agent-deployment-config
      mountPath: /observe-agent-conf
  # ----------------------------------------- #
